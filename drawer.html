<!DOCTYPE html>
<html>
   <head>
      <script src="https://unpkg.com/konva@8.1.1/konva.min.js"></script>
      <meta charset="utf-8" />
      <title>Konva Free Drawing Demo</title>
      <style>
         body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
         }
      </style>
   </head>

   <body>
      Tool:
      <select id="tool">
         <option value="brush">Brush</option>
         <option value="eraser">Eraser</option>
      </select>
      Brush size:
      <select id="size">
         <option value="5">5</option>
         <option value="10">10</option>
         <option value="20">20</option>
         <option value="50">50</option>
      </select>
      <div id="container"></div>
      <script>
         var width = window.innerWidth;
         var height = window.innerHeight - 25;

         // first we need Konva core things: stage and layer
         var stage = new Konva.Stage({
            container: 'container',
            width: width,
            height: height,
         });

         var layer = new Konva.Layer();
         stage.add(layer);

         var isPaint = false;
         var mode = 'brush';
         var lastLine;
         var lines = [4];

         stage.on('mousedown touchstart', function (e) {
            isPaint = true;
            var pos = stage.getPointerPosition();
            //lastLine = drawLine(pos.x, pos.y);
            lines[0] = drawLine(pos.x, pos.y);
            lines[1] = drawLine(width - pos.x, pos.y);
            lines[2] = drawLine(pos.x, height - pos.y);
            lines[3] = drawLine(width - pos.x, height - pos.y);
            for (var i = 0; i < 4; i++) layer.add(lines[i]);
            //layer.add(lastLine);
         });

         function drawLine(x, y) {
            return new Konva.Line({
               stroke: '#df4b26',
               strokeWidth: document.getElementById('size').value,
               globalCompositeOperation: mode === 'brush' ? 'source-over' : 'destination-out',
               points: [x, y],
            });
         }

         stage.on('mouseup touchend', function () {
            isPaint = false;
         });

         // and core function - drawing
         stage.on('mousemove touchmove', function () {
            if (!isPaint) {
               return;
            }

            const pos = stage.getPointerPosition();
            var newLines = [4];
            newLines[0] = lines[0].points().concat([pos.x, pos.y]);
            newLines[1] = lines[1].points().concat([width - pos.x, pos.y]);
            newLines[2] = lines[2].points().concat([pos.x, height - pos.y]);
            newLines[3] = lines[3].points().concat([width - pos.x, height - pos.y]);
            for (var i = 0; i < 4; i++) lines[i].points(newLines[i]);
         });

         var select = document.getElementById('tool');
         select.addEventListener('change', function () {
            mode = select.value;
         });
      </script>
   </body>
</html>
